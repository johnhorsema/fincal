import{a as x}from"./index-Ckg37GOx.js";import{C as k,r as P,c as _,d as U,s as C,u as E,a as n,o as a,l as b,b as r,t as l,n as I,F as A,g as F}from"./vendor-D5qdfc4z.js";const c=P(null),u=P(null),B=_(()=>c.value!==null),m="social-accounting-current-user",f="social-accounting-current-persona";function te(){async function s(){try{const e=localStorage.getItem(m),t=localStorage.getItem(f);if(e){const o=await h(e);if(o&&(c.value=o,t)){const d=o.personas.find(S=>S.id===t);d&&(u.value=d)}}}catch(e){console.error("Failed to initialize auth:",e),localStorage.removeItem(m),localStorage.removeItem(f)}}async function p(e){try{const t=await v(e);return t?(c.value=t,t.personas.length>0&&(u.value=t.personas[0]),!0):!1}catch(t){return console.error("Login failed:",t),!1}}function g(){c.value=null,u.value=null,localStorage.removeItem(m),localStorage.removeItem(f)}function i(e){if(!c.value)throw new Error("No user is currently logged in");if(!c.value.personas.find(o=>o.id===e.id))throw new Error("Persona does not belong to current user");u.value=e}async function h(e){try{return await x.request(`/users/${e}`)}catch(t){return console.error("Failed to get user by ID:",t),null}}async function v(e){try{return(await x.getUsers()).find(o=>o.email===e)||null}catch(t){return console.error("Failed to get user by email:",t),null}}async function w(e){try{return await x.createUser(e)}catch(t){return console.error("Failed to create user:",t),null}}async function y(){try{return await x.getUsers()}catch(e){return console.error("Failed to get all users:",e),[]}}return k(c,e=>{e?localStorage.setItem(m,e.id):localStorage.removeItem(m)}),k(u,e=>{e?localStorage.setItem(f,e.id):localStorage.removeItem(f)}),{currentUser:_(()=>c.value),currentPersona:_(()=>u.value),isAuthenticated:B,initializeAuth:s,login:p,logout:g,switchPersona:i,createUser:w,getAllUsers:y,getUserById:h,getUserByEmail:v}}const z={class:"persona-selector"},L={key:0,class:"block text-sm font-medium text-gray-700 mb-2"},N={class:"relative"},O={key:0,class:"flex items-center space-x-3"},D={class:"w-8 h-8 bg-gray-900 rounded-full flex items-center justify-center text-white text-sm font-medium"},R={class:"flex-1 min-w-0"},j={class:"flex items-center space-x-2"},G={class:"text-gray-900 font-medium"},K={class:"text-gray-500 text-sm"},M={key:1,class:"text-gray-500"},T={key:0,class:"absolute z-10 mt-1 w-full bg-white border border-gray-100 rounded-md shadow-sm max-h-60 overflow-auto"},V=["onClick"],Y={class:"flex items-center space-x-3"},$={class:"w-8 h-8 bg-gray-900 rounded-full flex items-center justify-center text-white text-sm font-medium"},q={class:"flex-1 min-w-0"},H={class:"flex items-center space-x-2"},J={class:"text-gray-900 font-medium"},Q={class:"text-gray-500 text-sm"},W={key:0,class:"py-3 px-3 text-gray-500 text-sm"},X={key:1,class:"mt-1 text-sm text-red-600"},re=U({__name:"PersonaSelector",props:{personas:{},selectedPersona:{},label:{default:""},placeholder:{default:"Select a persona..."},error:{}},emits:["update:selectedPersona","change"],setup(s,{emit:p}){const g=p,i=P(!1);function h(){i.value=!i.value}function v(e){g("update:selectedPersona",e),g("change",e),i.value=!1}function w(){i.value=!1}function y(e){e.target.closest(".persona-selector")||w()}return C(()=>{document.addEventListener("click",y)}),E(()=>{document.removeEventListener("click",y)}),(e,t)=>(a(),n("div",z,[s.label?(a(),n("label",L,l(s.label),1)):b("",!0),r("div",N,[r("button",{type:"button",class:I(["relative w-full bg-white border border-gray-200 rounded-md pl-3 pr-8 py-3 text-left cursor-pointer focus:outline-none focus:ring-1 focus:ring-gray-900 focus:border-gray-300 transition-colors",{"border-red-200 focus:ring-red-500 focus:border-red-300":s.error}]),onClick:h},[s.selectedPersona?(a(),n("div",O,[r("div",D,l(s.selectedPersona.name.charAt(0).toUpperCase()),1),r("div",R,[r("div",j,[r("span",G,l(s.selectedPersona.name),1),r("span",K,"("+l(s.selectedPersona.role)+")",1)])])])):(a(),n("span",M,l(s.placeholder),1)),t[0]||(t[0]=r("span",{class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},[r("svg",{class:"h-4 w-4 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[r("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1))],2),i.value?(a(),n("div",T,[(a(!0),n(A,null,F(s.personas,o=>{var d;return a(),n("div",{key:o.id,class:I(["cursor-pointer select-none py-3 px-3 hover:bg-gray-25 transition-colors",{"bg-gray-50":((d=s.selectedPersona)==null?void 0:d.id)===o.id}]),onClick:S=>v(o)},[r("div",Y,[r("div",$,l(o.name.charAt(0).toUpperCase()),1),r("div",q,[r("div",H,[r("span",J,l(o.name),1),r("span",Q,"("+l(o.role)+")",1)])])])],10,V)}),128)),s.personas.length===0?(a(),n("div",W," No personas available ")):b("",!0)])):b("",!0)]),s.error?(a(),n("p",X,l(s.error),1)):b("",!0)]))}});export{re as _,te as u};
