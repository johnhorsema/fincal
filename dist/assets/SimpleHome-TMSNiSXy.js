import{a as K,A as G}from"./index-Ckg37GOx.js";import{r as D,c as P,d as W,a,o as s,n as q,x as pe,l as T,b as e,h as Q,w as Z,B as ee,t as m,j as fe,C as re,s as he,F as X,g as te,f as ce,k as se,D as R,E as xe,G as we,i as ae,e as _e}from"./vendor-D5qdfc4z.js";import{u as ue,_ as ye}from"./PersonaSelector.vue_vue_type_script_setup_true_lang-DV2e7bl_.js";import{u as ke,v as ie,a as le,A as $e,f as Ce,b as de,g as ne,c as me}from"./validation-DEoFzFxq.js";function oe(){const o=D([]),y=D(!1),r=D(null),b=P(()=>[...o.value].sort((d,c)=>new Date(c.createdAt).getTime()-new Date(d.createdAt).getTime())),E=async()=>{try{y.value=!0,r.value=null;const d=await K.getPosts();return o.value=d,d}catch(d){const c=d instanceof G?d.message:"Failed to fetch posts";throw r.value=c,d}finally{y.value=!1}},V=async d=>{try{y.value=!0,r.value=null;const c=await K.createPost(d);return o.value.unshift(c),c}catch(c){const w=c instanceof G?c.message:"Failed to create post";throw r.value=w,c}finally{y.value=!1}},i=async(d,c)=>{try{y.value=!0,r.value=null;const w=await K.updatePost(d,c),F=o.value.findIndex(B=>B.id===d);return F!==-1&&(o.value[F]=w),w}catch(w){const F=w instanceof G?w.message:"Failed to update post";throw r.value=F,w}finally{y.value=!1}},g=async d=>{try{y.value=!0,r.value=null,await K.deletePost(d),o.value=o.value.filter(c=>c.id!==d)}catch(c){const w=c instanceof G?c.message:"Failed to delete post";throw r.value=w,c}finally{y.value=!1}},p=d=>o.value.find(c=>c.id===d),C=async d=>{try{y.value=!0,r.value=null;const c=await K.getPost(d),w=o.value.findIndex(F=>F.id===d);return w!==-1?o.value[w]=c:o.value.push(c),c}catch(c){const w=c instanceof G?c.message:"Failed to fetch post";throw r.value=w,c}finally{y.value=!1}},_=async d=>{try{return(await K.checkPostFinancialSuggestion(d)).suggestsFinancial}catch(c){console.warn("Failed to check financial suggestion:",c);const w=p(d);return w?S(w.content):!1}},S=d=>{const c=["paid","received","invoice","expense","revenue","cost","bill","purchase","sale","deposit","withdrawal","transfer","payment","$","€","£","USD","EUR","GBP","money","cash","credit","debit"],w=d.toLowerCase();return c.some(F=>w.includes(F))};return{posts:b,isLoading:y,error:r,fetchPosts:E,createPost:V,updatePost:i,deletePost:g,getPost:p,fetchPost:C,suggestsFinancialActivity:_,suggestsFinancialActivityLocal:S,clearError:()=>{r.value=null},refreshPosts:async()=>E()}}const ge=W({__name:"Card",props:{variant:{default:"default"},padding:{default:"md"},interactive:{type:Boolean,default:!1}},setup(o){const y=o,r=P(()=>{const b="bg-white rounded-lg transition-colors",E={default:"shadow-sm border border-gray-200",elevated:"shadow-sm border border-gray-100",outlined:"border border-gray-100"},V={none:"",sm:"p-4",md:"p-6",lg:"p-8"},i=y.interactive?"hover:bg-gray-50 cursor-pointer":"";return[b,E[y.variant],V[y.padding],i].filter(Boolean).join(" ")});return(b,E)=>(s(),a("div",{class:q(r.value)},[pe(b.$slots,"default")],2))}});function ve(){const o=D([]),y=D(!1),r=D(null),b=P(()=>o.value.filter(x=>x.status==="pending")),E=P(()=>o.value.filter(x=>x.status==="approved")),V=P(()=>o.value.filter(x=>x.status==="rejected"));async function i(x){y.value=!0,r.value=null;try{const t=await K.getTransactions(x);return o.value=t,t}catch(t){const l=t instanceof G?t.message:"Failed to fetch transactions";r.value=l,console.error("Error fetching transactions:",t)}finally{y.value=!1}}async function g(x){y.value=!0,r.value=null;try{const t=await K.getTransaction(x),l=o.value.findIndex(h=>h.id===x);return l!==-1?o.value[l]=t:o.value.push(t),t}catch(t){const l=t instanceof G?t.message:"Failed to fetch transaction";throw r.value=l,console.error("Error fetching transaction:",t),t}finally{y.value=!1}}async function p(x){y.value=!0,r.value=null;try{const t=await K.createTransaction(x);return o.value.push(t),t}catch(t){const l=t instanceof G?t.message:"Failed to create transaction";throw r.value=l,console.error("Error creating transaction:",t),t}finally{y.value=!1}}async function C(x,t){y.value=!0,r.value=null;try{const l=await K.updateTransaction(x,t),h=o.value.findIndex(v=>v.id===x);return h!==-1&&(o.value[h]={...o.value[h],...l}),o.value[h]}catch(l){const h=l instanceof G?l.message:"Failed to update transaction";throw r.value=h,console.error("Error updating transaction:",l),l}finally{y.value=!1}}async function _(x,t){y.value=!0,r.value=null;try{await K.approveTransaction(x,t);const l=o.value.findIndex(h=>h.id===x);return l!==-1&&(o.value[l].status="approved",o.value[l].approvedBy=t),o.value[l]}catch(l){const h=l instanceof G?l.message:"Failed to approve transaction";throw r.value=h,console.error("Error approving transaction:",l),l}finally{y.value=!1}}async function S(x){y.value=!0,r.value=null;try{await K.rejectTransaction(x);const t=o.value.findIndex(l=>l.id===x);return t!==-1&&(o.value[t].status="rejected"),o.value[t]}catch(t){const l=t instanceof G?t.message:"Failed to reject transaction";throw r.value=l,console.error("Error rejecting transaction:",t),t}finally{y.value=!1}}async function f(x){y.value=!0,r.value=null;try{await K.deleteTransaction(x),o.value=o.value.filter(t=>t.id!==x)}catch(t){const l=t instanceof G?t.message:"Failed to delete transaction";throw r.value=l,console.error("Error deleting transaction:",t),t}finally{y.value=!1}}function A(x){return o.value.find(t=>t.id===x)}function d(x){return o.value.find(t=>t.postId===x)}function c(x){return o.value.filter(t=>t.status===x)}function w(x){return o.value.filter(t=>t.createdBy===x)}function F(x){const t=x.entries.reduce((v,M)=>v+(M.debitAmount||0),0),l=x.entries.reduce((v,M)=>v+(M.creditAmount||0),0),h=Math.abs(t-l);return{totalDebits:Math.round(t*100)/100,totalCredits:Math.round(l*100)/100,balance:Math.round(h*100)/100,isBalanced:h<.01}}function B(){r.value=null}return{transactionsList:o,loading:y,error:r,pendingTransactions:b,approvedTransactions:E,rejectedTransactions:V,fetchTransactions:i,fetchTransaction:g,createTransaction:p,updateTransaction:C,approveTransaction:_,rejectTransaction:S,deleteTransaction:f,getTransaction:A,getTransactionByPostId:d,getTransactionsByStatus:c,getTransactionsByUser:w,calculateTransactionTotals:F,clearError:B}}const Te=["type","disabled"],Ae={key:0,class:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin mr-2"},Me=W({__name:"Button",props:{variant:{default:"primary"},size:{default:"md"},type:{default:"button"},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["click"],setup(o){const y=o,r=P(()=>{const b="inline-flex items-center justify-center font-medium rounded-md transition-colors focus:outline-none focus:ring-1 disabled:opacity-50 disabled:cursor-not-allowed",E={primary:"bg-gray-900 text-white hover:bg-gray-800 focus:ring-gray-900",secondary:"bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 focus:ring-gray-900",outline:"border border-gray-200 bg-white text-gray-700 hover:bg-gray-50 focus:ring-gray-900",ghost:"text-gray-500 hover:text-gray-900 hover:bg-gray-50 focus:ring-gray-900"},V={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return[b,E[y.variant],V[y.size]].join(" ")});return(b,E)=>(s(),a("button",{type:o.type,disabled:o.disabled||o.loading,class:q(r.value),onClick:E[0]||(E[0]=V=>b.$emit("click",V))},[o.loading?(s(),a("div",Ae)):T("",!0),pe(b.$slots,"default")],10,Te))}}),Pe={class:"bg-white border border-gray-200 rounded-lg shadow-sm p-6"},Ie={class:"space-y-4"},je={class:"relative"},De=["maxlength"],Ee={key:0,class:"text-sm text-red-600"},Fe={key:1,class:"text-sm text-red-600"},Se={class:"flex items-center justify-between"},Be=["disabled"],Ve={key:1},ze=["disabled"],Ue={key:0,class:"flex items-center space-x-2"},Le={key:1},Oe=W({__name:"PostComposer",props:{placeholder:{},maxLength:{}},emits:["posted","error","create-journal"],setup(o,{emit:y}){const r=o,b=y,{createPost:E,suggestsFinancialActivityLocal:V}=oe(),{currentUser:i,currentPersona:g}=ue(),{handleFormSubmit:p,validateForm:C,hasFieldError:_,getFieldErrorMessage:S,clearAllErrors:f}=ke(),A=D(""),d=D(g.value||null),c=D([]),w=D(!1),F=P(()=>r.maxLength||500),B={content:[ie.required("Post content is required"),ie.maxLength(F.value,`Content cannot exceed ${F.value} characters`)],authorPersona:[ie.required("Please select a persona")]},x=P(()=>{var z;return((z=i.value)==null?void 0:z.personas)||[]}),t=P(()=>d.value),l=P(()=>_("content")),h=P(()=>_("authorPersona")),v=P(()=>S("content")),M=P(()=>S("authorPersona")),U=P(()=>V(A.value)),N=P(()=>A.value.trim().length>0&&A.value.length<=F.value&&d.value&&!w.value&&!l.value&&!h.value),u=z=>{d.value=z},n=()=>{_("content")&&f(),A.value.length>F.value&&C({content:A.value},{content:B.content})},$=async()=>{if(!i.value||!d.value)return;const z={content:A.value,authorPersona:d.value.name};if(!C(z,B))return;w.value=!0;const L=await p(async()=>{const O=await E({content:A.value.trim(),authorId:i.value.id,authorPersona:d.value.name,attachments:c.value.length>0?[...c.value]:void 0});return A.value="",c.value=[],b("posted",O),O},{context:{component:"PostComposer",action:"createPost"}});w.value=!1,L||b("error","Failed to create post")},I=()=>{var z;b("create-journal",{content:A.value.trim(),authorPersona:(z=d.value)==null?void 0:z.name})};return g.value&&(d.value=g.value),(z,L)=>(s(),a("div",Pe,[e("div",Ie,[e("div",null,[Q(ye,{"selected-persona":t.value,personas:x.value,onChange:u,placeholder:"Select persona..."},null,8,["selected-persona","personas"])]),e("div",je,[Z(e("textarea",{"onUpdate:modelValue":L[0]||(L[0]=O=>A.value=O),placeholder:"E.g. 'Paid meal from credit card for 2k'",maxlength:F.value,rows:"3",class:q(["w-full p-3 border border-gray-200 rounded-md resize-none focus:outline-none focus:ring-1 focus:ring-gray-900 focus:border-gray-300 transition-colors text-gray-900 placeholder-gray-400",{"border-red-200 focus:ring-red-500 focus:border-red-300":l.value}]),onInput:n},null,42,De),[[ee,A.value]])]),l.value?(s(),a("div",Ee,m(v.value),1)):T("",!0),h.value?(s(),a("div",Fe,m(M.value),1)):T("",!0),e("div",Se,[U.value&&A.value.trim()?(s(),a("button",{key:0,onClick:I,disabled:!N.value||w.value,class:"inline-flex items-center px-4 py-2 border border-gray-200 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-1 focus:ring-gray-900 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," + Create Journal ",8,Be)):(s(),a("div",Ve)),e("button",{onClick:$,disabled:!N.value||w.value,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md text-sm font-medium text-white bg-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-1 focus:ring-gray-900 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[w.value?(s(),a("span",Ue,[...L[1]||(L[1]=[e("div",{class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1),e("span",null,"Posting...",-1)])])):(s(),a("span",Le,"Post"))],8,ze)])])]))}}),Je=W({__name:"SimplePostComposer",emits:["posted","create-journal","error"],setup(o,{emit:y}){const r=y,b=i=>{r("posted",i)},E=i=>{r("create-journal",i)},V=i=>{r("error",i)};return(i,g)=>(s(),fe(Oe,{onPosted:b,onCreateJournal:E,onError:V}))}}),He={class:"bg-white border border-gray-200 rounded-lg shadow-sm p-6"},Ne={class:"flex items-center space-x-3 mb-4"},qe={class:"w-8 h-8 bg-gray-900 rounded-full flex items-center justify-center flex-shrink-0"},Re={class:"text-white font-medium text-sm"},Ke={class:"flex items-center space-x-2 text-sm min-w-0 flex-1"},Qe={class:"font-medium text-gray-900"},Ge=["datetime"],Ye={class:"mb-6 space-y-4"},We={class:"text-gray-900 leading-relaxed"},Xe={key:0},Ze={class:"flex flex-wrap gap-2"},et={class:"text-gray-700"},tt={key:0,class:"mb-6"},st={class:"bg-gray-50 rounded-lg border border-gray-200 overflow-hidden"},at={class:"flex items-center space-x-3"},ot={key:0,class:"border-t border-gray-200"},nt={class:"p-4 bg-white border-b border-gray-100"},rt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},lt={class:"text-gray-900 mt-1"},it={class:"text-gray-900 mt-1"},dt={key:0,class:"p-4 bg-white"},ct={class:"flex items-center justify-between mb-4"},ut={key:0,class:"text-xs text-gray-600 space-x-4"},vt={class:"font-mono"},mt={class:"font-mono"},gt={class:"bg-white rounded-md border border-gray-200 overflow-hidden"},pt={class:"divide-y divide-gray-100"},ft={class:"grid grid-cols-12 gap-4 items-center"},ht={class:"col-span-6"},yt={class:"font-medium text-gray-900 text-sm"},bt={class:"text-xs text-gray-500 mt-0.5 uppercase tracking-wide"},xt={class:"col-span-3 text-right"},wt={key:0,class:"font-mono text-sm text-gray-900 tabular-nums"},_t={key:1,class:"text-gray-400 text-sm font-mono"},kt={class:"col-span-3 text-right"},$t={key:0,class:"font-mono text-sm text-gray-900 tabular-nums"},Ct={key:1,class:"text-gray-400 text-sm font-mono"},Tt={key:1,class:"mb-4 p-3 bg-yellow-50 rounded-lg"},At={class:"flex items-center justify-between pt-4 border-t border-gray-100"},Mt={class:"flex items-center space-x-4"},Pt={key:1,class:"flex items-center space-x-2"},It=W({__name:"PostCard",props:{post:{}},emits:["createJournal","viewTransaction","editTransaction"],setup(o,{emit:y}){const r=o,b=y,{suggestsFinancialActivityLocal:E}=oe(),{getTransaction:V,calculateTransactionTotals:i}=ve(),{accountsList:g}=le(),p=D(null),C=D(null),_=D(!1),S=P(()=>E(r.post.content)),f=P(()=>{if(!p.value)return null;const h=p.value.status;return{pending:{label:"Pending Review",bgColor:"bg-yellow-100",textColor:"text-yellow-800",borderColor:"border-yellow-200",icon:"clock"},approved:{label:"Approved",bgColor:"bg-green-100",textColor:"text-green-800",borderColor:"border-green-200",icon:"check"},rejected:{label:"Rejected",bgColor:"bg-red-100",textColor:"text-red-800",borderColor:"border-red-200",icon:"x"}}[h]}),A=P(()=>{var h;return(h=p.value)!=null&&h.entries?p.value.entries.map(v=>{const M=g.value.find(U=>U.id===v.accountId);return{...v,accountName:(M==null?void 0:M.name)||v.accountId,accountType:(M==null?void 0:M.type)||"unknown"}}):[]}),d=h=>{const M=Math.floor((new Date().getTime()-h.getTime())/(1e3*60));if(M<1)return"just now";if(M<60)return`${M}m ago`;if(M<1440)return`${Math.floor(M/60)}h ago`;{const U=Math.floor(M/1440);return U===1?"yesterday":U<7?`${U}d ago`:c(h)}},c=h=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(h),w=h=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(h),F=()=>{_.value=!_.value},B=()=>{b("createJournal",r.post)},x=()=>{r.post.transactionId&&b("viewTransaction",r.post.transactionId)},t=()=>{r.post.transactionId&&b("editTransaction",r.post.transactionId)},l=async()=>{if(r.post.transactionId){const h=V(r.post.transactionId);h&&(p.value=h,C.value=i(h))}};return re(()=>r.post.transactionId,()=>{l()},{immediate:!0}),he(()=>{l()}),(h,v)=>{var M,U,N;return s(),a("div",He,[e("div",Ne,[e("div",qe,[e("span",Re,m(o.post.authorPersona.charAt(0)),1)]),e("div",Ke,[e("span",Qe,m(o.post.authorPersona),1),v[2]||(v[2]=e("span",{class:"text-gray-400"},"•",-1)),e("time",{class:"text-gray-500",datetime:o.post.createdAt.toISOString()},m(d(o.post.createdAt)),9,Ge),o.post.transactionId?(s(),a(X,{key:0},[v[0]||(v[0]=e("span",{class:"text-gray-400"},"•",-1)),v[1]||(v[1]=e("span",{class:"text-green-600 font-medium"},"Journal Entry",-1))],64)):T("",!0)])]),e("div",Ye,[e("div",null,[e("p",We,m(o.post.content),1)]),o.post.attachments&&o.post.attachments.length>0?(s(),a("div",Xe,[e("div",Ze,[(s(!0),a(X,null,te(o.post.attachments,u=>(s(),a("div",{key:u,class:"flex items-center space-x-2 bg-gray-50 px-3 py-2 rounded-md text-sm"},[v[3]||(v[3]=e("svg",{class:"w-4 h-4 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z","clip-rule":"evenodd"})],-1)),e("span",et,m(u),1)]))),128))])])):T("",!0)]),o.post.transactionId&&p.value?(s(),a("div",tt,[v[11]||(v[11]=e("div",{class:"border-t border-gray-100 mb-4"},null,-1)),e("div",st,[e("button",{onClick:F,class:"w-full p-4 flex items-center justify-between hover:bg-gray-100 transition-colors"},[e("div",at,[v[4]||(v[4]=e("svg",{class:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z","clip-rule":"evenodd"})],-1)),v[5]||(v[5]=e("h4",{class:"font-medium text-gray-900"},"Transaction Details",-1)),e("span",{class:q(["text-xs px-2 py-1 rounded-full font-medium",((M=f.value)==null?void 0:M.bgColor)||"bg-gray-100",((U=f.value)==null?void 0:U.textColor)||"text-gray-700"])},m(((N=f.value)==null?void 0:N.label)||p.value.status),3)]),(s(),a("svg",{class:q(["w-5 h-5 text-gray-500 transition-transform",{"rotate-180":_.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...v[6]||(v[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),_.value?(s(),a("div",ot,[e("div",nt,[e("div",rt,[e("div",null,[v[7]||(v[7]=e("span",{class:"font-medium text-gray-700"},"Description:",-1)),e("p",lt,m(p.value.description),1)]),e("div",null,[v[8]||(v[8]=e("span",{class:"font-medium text-gray-700"},"Date:",-1)),e("p",it,m(c(p.value.date)),1)])])]),A.value.length>0?(s(),a("div",dt,[e("div",ct,[v[9]||(v[9]=e("h5",{class:"font-medium text-gray-900"},"Account Entries",-1)),C.value?(s(),a("div",ut,[e("span",vt,"Dr: "+m(w(C.value.totalDebits)),1),e("span",mt,"Cr: "+m(w(C.value.totalCredits)),1)])):T("",!0)]),e("div",gt,[v[10]||(v[10]=ce('<div class="bg-gray-50 px-4 py-3 border-b border-gray-200"><div class="grid grid-cols-12 gap-4 text-xs font-semibold text-gray-700 uppercase tracking-wide"><div class="col-span-6">Account</div><div class="col-span-3 text-right">Debit</div><div class="col-span-3 text-right">Credit</div></div></div>',1)),e("div",pt,[(s(!0),a(X,null,te(A.value,u=>(s(),a("div",{key:u.id,class:"px-4 py-3 hover:bg-gray-50 transition-colors"},[e("div",ft,[e("div",ht,[e("div",yt,m(u.accountName),1),e("div",bt,m(u.accountType),1)]),e("div",xt,[u.debitAmount?(s(),a("span",wt,m(w(u.debitAmount)),1)):(s(),a("span",_t,"—"))]),e("div",kt,[u.creditAmount?(s(),a("span",$t,m(w(u.creditAmount)),1)):(s(),a("span",Ct,"—"))])])]))),128))])])])):T("",!0)])):T("",!0)])])):T("",!0),!o.post.transactionId&&S.value?(s(),a("div",Tt,[...v[12]||(v[12]=[e("div",{class:"flex items-center space-x-2"},[e("svg",{class:"w-4 h-4 text-yellow-700",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("p",{class:"text-sm text-yellow-800"},"Financial activity detected. Consider creating a journal entry.")],-1)])])):T("",!0),e("div",At,[e("div",Mt,[o.post.transactionId?T("",!0):(s(),a("button",{key:0,onClick:B,class:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-white bg-gray-900 rounded-md hover:bg-gray-800 transition-colors"},[...v[13]||(v[13]=[e("svg",{class:"w-4 h-4 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z","clip-rule":"evenodd"})],-1),se(" Create Journal ",-1)])])),o.post.transactionId?(s(),a("div",Pt,[e("button",{onClick:x,class:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-md hover:bg-gray-50 transition-colors"},[...v[14]||(v[14]=[e("svg",{class:"w-4 h-4 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),e("path",{"fill-rule":"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z","clip-rule":"evenodd"})],-1),se(" View Details ",-1)])]),p.value&&(p.value.status==="pending"||p.value.status==="rejected")?(s(),a("button",{key:0,onClick:t,class:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-md hover:bg-gray-50 transition-colors"},[...v[15]||(v[15]=[e("svg",{class:"w-4 h-4 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})],-1),se(" Edit Transaction ",-1)])])):T("",!0)])):T("",!0)]),v[16]||(v[16]=ce('<div class="flex items-center space-x-1"><button class="p-2 text-gray-400 hover:text-gray-500 hover:bg-gray-50 rounded-md transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg></button><button class="p-2 text-gray-400 hover:text-gray-500 hover:bg-gray-50 rounded-md transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path></svg></button><button class="p-2 text-gray-400 hover:text-gray-500 hover:bg-gray-50 rounded-md transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></button></div>',1))])])}}}),jt={class:"relative"},Dt={key:0,class:"text-red-500"},Et={class:"relative"},Ft=["placeholder"],St={key:1,class:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto"},Bt={key:0,class:"py-1"},Vt={class:"px-3 py-1 text-xs font-semibold text-gray-500 uppercase bg-gray-50"},zt=["onClick","onMouseenter"],Ut={class:"flex justify-between items-center"},Lt={class:"font-medium text-gray-900"},Ot={class:"text-xs text-gray-500"},Jt={key:0,class:"text-xs text-red-500"},Ht={key:0,class:"border-t border-gray-200"},Nt={class:"flex items-center"},qt={key:1,class:"px-3 py-2 text-sm text-gray-500"},Rt={key:2,class:"mt-1 text-sm text-red-600"},Kt=W({__name:"AccountSelector",props:{modelValue:{},label:{},placeholder:{default:"Search accounts..."},required:{type:Boolean},allowCreate:{type:Boolean,default:!1},filterType:{},includeInactive:{type:Boolean,default:!1},errorMessage:{}},emits:["update:modelValue","create-account"],setup(o,{expose:y,emit:r}){const b=o,E=r,{accountsList:V,fetchAccounts:i}=le(),g=D(""),p=D(!1),C=D(-1),_=`account-selector-${Math.random().toString(36).substr(2,9)}`;i();const S=P(()=>{let t=b.includeInactive?V.value:V.value.filter(l=>l.isActive);if(b.filterType&&(t=t.filter(l=>l.type===b.filterType)),g.value.trim()){const l=g.value.toLowerCase();t=t.filter(h=>h.name.toLowerCase().includes(l)||h.category.toLowerCase().includes(l))}return t}),f=P(()=>{const t={asset:[],liability:[],equity:[],revenue:[],expense:[]};return S.value.forEach(l=>{l.type in t&&t[l.type].push(l)}),t}),A=P(()=>S.value.some(t=>t.name.toLowerCase()===g.value.toLowerCase().trim())),d=P(()=>b.required&&!b.modelValue&&b.errorMessage);re(()=>b.modelValue,t=>{t?g.value=t.name:g.value=""},{immediate:!0});function c(t){g.value=t.name,p.value=!1,C.value=-1,E("update:modelValue",t)}function w(){setTimeout(()=>{p.value=!1,C.value=-1,!A.value&&!b.modelValue&&(g.value="",E("update:modelValue",null))},200)}function F(t){if(!p.value){(t.key==="ArrowDown"||t.key==="Enter")&&(p.value=!0,t.preventDefault());return}switch(t.key){case"ArrowDown":t.preventDefault(),C.value=Math.min(C.value+1,S.value.length-1);break;case"ArrowUp":t.preventDefault(),C.value=Math.max(C.value-1,-1);break;case"Enter":t.preventDefault(),C.value>=0&&C.value<S.value.length?c(S.value[C.value]):b.allowCreate&&g.value.trim()&&!A.value&&E("create-account",g.value.trim());break;case"Escape":p.value=!1,C.value=-1;break}}function B(t){return S.value.findIndex(l=>l.id===t.id)}function x(){g.value="",E("update:modelValue",null)}return y({clearSelection:x}),(t,l)=>(s(),a("div",jt,[o.label?(s(),a("label",{key:0,for:_,class:"block text-sm font-medium text-gray-700 mb-1"},[se(m(o.label)+" ",1),o.required?(s(),a("span",Dt,"*")):T("",!0)])):T("",!0),e("div",Et,[Z(e("input",{id:_,"onUpdate:modelValue":l[0]||(l[0]=h=>g.value=h),type:"text",placeholder:o.placeholder,class:q(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-300":d.value}]),onFocus:l[1]||(l[1]=h=>p.value=!0),onBlur:w,onKeydown:F,autocomplete:"off"},null,42,Ft),[[ee,g.value]]),l[3]||(l[3]=e("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},[e("svg",{class:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))]),p.value&&(S.value.length>0||o.allowCreate)?(s(),a("div",St,[(s(!0),a(X,null,te(f.value,(h,v)=>(s(),a(X,{key:v},[h.length>0?(s(),a("div",Bt,[e("div",Vt,m(R($e)[v]),1),(s(!0),a(X,null,te(h,M=>(s(),a("button",{key:M.id,type:"button",class:q(["w-full text-left px-3 py-2 text-sm hover:bg-gray-100 focus:bg-gray-100 focus:outline-none",{"bg-blue-50":C.value===B(M)}]),onClick:U=>c(M),onMouseenter:U=>C.value=B(M)},[e("div",Ut,[e("div",null,[e("div",Lt,m(M.name),1),e("div",Ot,m(M.category),1)]),M.isActive?T("",!0):(s(),a("div",Jt,"Inactive"))])],42,zt))),128))])):T("",!0)],64))),128)),o.allowCreate&&g.value.trim()&&!A.value?(s(),a("div",Ht,[e("button",{type:"button",class:"w-full text-left px-3 py-2 text-sm text-blue-600 hover:bg-blue-50 focus:bg-blue-50 focus:outline-none",onClick:l[2]||(l[2]=h=>t.$emit("create-account",g.value.trim()))},[e("div",Nt,[l[4]||(l[4]=e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)),se(' Create "'+m(g.value.trim())+'" ',1)])])])):T("",!0),S.value.length===0&&!o.allowCreate?(s(),a("div",qt," No accounts found ")):T("",!0)])):T("",!0),d.value&&o.errorMessage?(s(),a("p",Rt,m(o.errorMessage),1)):T("",!0)]))}}),Qt={key:0,class:"fixed inset-0 z-50 overflow-y-auto","data-testid":"transaction-modal"},Gt={class:"flex min-h-full items-center justify-center p-4"},Yt={class:"relative w-full max-w-2xl bg-white rounded-lg shadow-xl"},Wt={class:"flex items-center justify-between p-6 border-b border-gray-200"},Xt={class:"text-xl font-semibold text-gray-900"},Zt={class:"p-6"},es={class:"mb-6 p-4 bg-gray-50 rounded-lg"},ts={class:"text-gray-900"},ss={class:"flex items-center mt-2 text-sm text-gray-500"},as={class:"mb-4"},os={key:0,class:"mt-1 text-sm text-red-600"},ns={class:"mb-6"},rs=["max"],ls={key:0,class:"mt-1 text-sm text-red-600"},is={class:"mb-6"},ds={class:"space-y-3"},cs={class:"flex items-start space-x-4"},us={class:"flex-1"},vs={class:"w-32"},ms=["onUpdate:modelValue","onInput"],gs={class:"w-32"},ps=["onUpdate:modelValue","onInput"],fs={class:"flex items-end"},hs=["onClick"],ys={key:0,class:"mt-2"},bs={key:0,class:"text-sm text-red-600"},xs={key:1,class:"text-sm text-red-600"},ws={class:"mt-4 p-3 bg-gray-50 rounded-lg"},_s={class:"flex justify-between items-center text-sm"},ks={class:"font-mono"},$s={class:"flex justify-between items-center text-sm mt-1"},Cs={class:"font-mono"},Ts={class:"flex justify-between items-center text-sm mt-2 pt-2 border-t border-gray-200"},As={key:0,class:"mt-2 text-sm text-red-600"},Ms={key:0,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md"},Ps={class:"text-sm text-red-600"},Is={class:"flex justify-end space-x-3"},js=["disabled"],Ds={key:0},Es={key:1},be=W({__name:"TransactionModal",props:{isOpen:{type:Boolean},post:{},existingTransaction:{}},emits:["close","transactionCreated","transactionUpdated"],setup(o,{emit:y}){const r=o,b=y,{currentUser:E}=ue(),{accountsList:V}=le(),i=D({description:"",date:new Date().toISOString().split("T")[0],entries:[]}),g=D({}),p=D([]),C=D(!1),_=P(()=>!!r.existingTransaction),S=P(()=>new Date().toISOString().split("T")[0]),f=P(()=>i.value.entries.reduce((u,n)=>{const $=parseFloat(n.debitAmount)||0;return u+$},0)),A=P(()=>i.value.entries.reduce((u,n)=>{const $=parseFloat(n.creditAmount)||0;return u+$},0)),d=P(()=>Math.abs(f.value-A.value)),c=P(()=>d.value<.01),w=P(()=>i.value.description.trim()!==""&&i.value.date!==""&&i.value.entries.length>=2&&c.value&&!C.value),F=()=>{r.existingTransaction?(i.value.description=r.existingTransaction.description,i.value.date=r.existingTransaction.date.toISOString().split("T")[0],i.value.entries=r.existingTransaction.entries.map(u=>{var n,$;return{id:u.id,accountId:u.accountId,debitAmount:((n=u.debitAmount)==null?void 0:n.toString())||"",creditAmount:(($=u.creditAmount)==null?void 0:$.toString())||""}})):r.post&&(i.value.description=r.post.content.length>200?r.post.content.substring(0,197)+"...":r.post.content,i.value.date=new Date().toISOString().split("T")[0],i.value.entries=[B(),B()]),g.value={},p.value=[]},B=()=>({id:ne(),accountId:"",debitAmount:"",creditAmount:""}),x=()=>{i.value.entries.push(B()),p.value.push({})},t=u=>{i.value.entries.length>2&&(i.value.entries.splice(u,1),p.value.splice(u,1))},l=u=>V.value.find(n=>n.id===u)||null,h=(u,n)=>{i.value.entries[u].accountId=n,p.value[u]&&delete p.value[u].account},v=(u,n,$)=>{const z=$.target.value;n==="debit"&&z?i.value.entries[u].creditAmount="":n==="credit"&&z&&(i.value.entries[u].debitAmount=""),p.value[u]&&(delete p.value[u].amount,delete p.value[u].debit,delete p.value[u].credit)},M=()=>{g.value={},p.value=i.value.entries.map(()=>({})),i.value.description.trim()?i.value.description.length>200&&(g.value.description="Description must be 200 characters or less"):g.value.description="Description is required",i.value.date?new Date(i.value.date)>new Date&&(g.value.date="Date cannot be in the future"):g.value.date="Date is required";let u=!0;return i.value.entries.forEach((n,$)=>{const I={};n.accountId||(I.account="Account is required",u=!1);const z=n.debitAmount&&parseFloat(n.debitAmount)>0,L=n.creditAmount&&parseFloat(n.creditAmount)>0;!z&&!L&&(I.amount="Either debit or credit amount is required",u=!1),z&&L&&(I.amount="Entry cannot have both debit and credit amounts",u=!1),z&&parseFloat(n.debitAmount)<=0&&(I.debit="Debit amount must be greater than 0",u=!1),L&&parseFloat(n.creditAmount)<=0&&(I.credit="Credit amount must be greater than 0",u=!1),p.value[$]=I}),u||(g.value.general="Please fix the entry errors above"),i.value.entries.length<2&&(g.value.general="Transaction must have at least 2 entries"),c.value||(g.value.general="Transaction must balance (debits must equal credits)"),Object.keys(g.value).length===0&&u},U=async()=>{if(!(!M()||!r.post||!E.value)){C.value=!0;try{if(_.value&&r.existingTransaction){const u=i.value.entries.map(I=>({id:I.id||ne(),transactionId:r.existingTransaction.id,accountId:I.accountId,debitAmount:I.debitAmount?parseFloat(I.debitAmount):void 0,creditAmount:I.creditAmount?parseFloat(I.creditAmount):void 0})),n={...r.existingTransaction,description:i.value.description.trim(),date:new Date(i.value.date),status:"pending",entries:u},$=me(n);if(!$.isValid){g.value.general=$.errors.join(", ");return}b("transactionUpdated",n)}else{const u=i.value.entries.map(I=>({id:ne(),transactionId:"",accountId:I.accountId,debitAmount:I.debitAmount?parseFloat(I.debitAmount):void 0,creditAmount:I.creditAmount?parseFloat(I.creditAmount):void 0})),n={id:ne(),postId:r.post.id,description:i.value.description.trim(),date:new Date(i.value.date),status:"pending",createdBy:E.value.id,entries:u};u.forEach(I=>{I.transactionId=n.id});const $=me(n);if(!$.isValid){g.value.general=$.errors.join(", ");return}b("transactionCreated",n)}N()}catch(u){console.error("Error saving transaction:",u),g.value.general=u instanceof Error?u.message:"Failed to save transaction"}finally{C.value=!1}}},N=()=>{b("close")};return re(()=>r.isOpen,u=>{u&&xe(()=>{F()})}),F(),(u,n)=>{var $,I,z;return o.isOpen?(s(),a("div",Qt,[e("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:N}),e("div",Gt,[e("div",Yt,[e("div",Wt,[e("h2",Xt,m(_.value?"Edit Journal Entry":"Create Journal Entry"),1),e("button",{onClick:N,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...n[2]||(n[2]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Zt,[e("div",es,[n[4]||(n[4]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Original Post",-1)),e("p",ts,m(($=o.post)==null?void 0:$.content),1),e("div",ss,[e("span",null,m((I=o.post)==null?void 0:I.authorPersona),1),n[3]||(n[3]=e("span",{class:"mx-2"},"•",-1)),e("span",null,m((z=o.post)!=null&&z.createdAt?R(Ce)(o.post.createdAt):""),1)])]),e("form",{onSubmit:we(U,["prevent"])},[e("div",as,[n[5]||(n[5]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"}," Description ",-1)),Z(e("input",{id:"description","onUpdate:modelValue":n[0]||(n[0]=L=>i.value.description=L),type:"text",class:q(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-300":g.value.description}]),placeholder:"Enter transaction description",maxlength:"200"},null,2),[[ee,i.value.description]]),g.value.description?(s(),a("div",os,m(g.value.description),1)):T("",!0)]),e("div",ns,[n[6]||(n[6]=e("label",{for:"date",class:"block text-sm font-medium text-gray-700 mb-2"}," Transaction Date ",-1)),Z(e("input",{id:"date","onUpdate:modelValue":n[1]||(n[1]=L=>i.value.date=L),type:"date",class:q(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-300":g.value.date}]),max:S.value},null,10,rs),[[ee,i.value.date]]),g.value.date?(s(),a("div",ls,m(g.value.date),1)):T("",!0)]),e("div",is,[e("div",{class:"flex items-center justify-between mb-4"},[n[8]||(n[8]=e("h3",{class:"text-lg font-medium text-gray-900"},"Journal Entries",-1)),e("button",{type:"button",onClick:x,"data-testid":"add-entry-button",class:"flex items-center space-x-1 px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"},[...n[7]||(n[7]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",null,"Add Entry",-1)])])]),e("div",ds,[(s(!0),a(X,null,te(i.value.entries,(L,O)=>{var j,k,J;return s(),a("div",{key:L.id,"data-testid":"transaction-entry",class:q(["p-4 border border-gray-200 rounded-lg",{"border-red-300":p.value[O]}])},[e("div",cs,[e("div",us,[n[9]||(n[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Account ",-1)),Q(Kt,{"model-value":l(L.accountId),error:(j=p.value[O])==null?void 0:j.account,onAccountSelected:H=>h(O,H)},null,8,["model-value","error","onAccountSelected"])]),e("div",vs,[n[10]||(n[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Debit ",-1)),Z(e("input",{"onUpdate:modelValue":H=>L.debitAmount=H,type:"number",step:"0.01",min:"0",max:"999999999.99",class:q(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-right",{"border-red-300":(k=p.value[O])==null?void 0:k.debit}]),placeholder:"0.00",onInput:H=>v(O,"debit",H)},null,42,ms),[[ee,L.debitAmount]])]),e("div",gs,[n[11]||(n[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Credit ",-1)),Z(e("input",{"onUpdate:modelValue":H=>L.creditAmount=H,type:"number",step:"0.01",min:"0",max:"999999999.99",class:q(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-right",{"border-red-300":(J=p.value[O])==null?void 0:J.credit}]),placeholder:"0.00",onInput:H=>v(O,"credit",H)},null,42,ps),[[ee,L.creditAmount]])]),e("div",fs,[i.value.entries.length>2?(s(),a("button",{key:0,type:"button",onClick:H=>t(O),"data-testid":"remove-entry-button",class:"p-2 text-red-600 hover:text-red-700 transition-colors",title:"Remove entry"},[...n[12]||(n[12]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,hs)):T("",!0)])]),p.value[O]?(s(),a("div",ys,[p.value[O].account?(s(),a("div",bs,m(p.value[O].account),1)):T("",!0),p.value[O].amount?(s(),a("div",xs,m(p.value[O].amount),1)):T("",!0)])):T("",!0)],2)}),128))]),e("div",ws,[e("div",_s,[n[13]||(n[13]=e("span",{class:"font-medium"},"Total Debits:",-1)),e("span",ks,m(R(de)(f.value)),1)]),e("div",$s,[n[14]||(n[14]=e("span",{class:"font-medium"},"Total Credits:",-1)),e("span",Cs,m(R(de)(A.value)),1)]),e("div",Ts,[n[15]||(n[15]=e("span",{class:"font-medium"},"Balance:",-1)),e("span",{class:q(["font-mono font-medium",c.value?"text-green-600":"text-red-600"])},m(R(de)(d.value)),3)]),c.value?T("",!0):(s(),a("div",As," Transaction must balance (debits must equal credits) "))])]),g.value.general?(s(),a("div",Ms,[e("div",Ps,m(g.value.general),1)])):T("",!0),e("div",Is,[e("button",{type:"button",onClick:N,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"}," Cancel "),e("button",{type:"submit",disabled:!w.value||C.value,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[C.value?(s(),a("span",Ds,m(_.value?"Updating...":"Creating..."),1)):(s(),a("span",Es,m(_.value?"Update Transaction":"Create Transaction"),1))],8,js)])],32)])])])])):T("",!0)}}}),Fs={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Ss={class:"bg-white rounded-lg shadow-sm max-w-4xl w-full max-h-[90vh] overflow-hidden border border-gray-200"},Bs={class:"flex items-center justify-between p-6 border-b border-gray-200"},Vs={class:"text-xl font-medium text-gray-900"},zs={class:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]"},Us={key:0,class:"space-y-6"},Ls={key:0},Os={class:"space-y-4"},Js=["max"],Hs={key:0},Ns={key:1},qs={class:"flex items-center justify-between p-4 bg-white rounded-lg border border-gray-200"},Rs={class:"flex items-center space-x-3"},Ks={class:"font-medium text-gray-900"},Qs={key:0,class:"text-sm text-gray-600 mt-1"},Gs={class:"text-sm text-gray-600"},Ys={class:"p-4 bg-white rounded-lg border border-gray-200"},Ws={class:"text-gray-700"},Xs={class:"p-4 bg-white rounded-lg border border-gray-200"},Zs={class:"flex items-center justify-between mb-4"},ea={key:0,class:"text-sm space-x-4"},ta={class:"font-mono text-gray-600"},sa={class:"font-mono text-gray-600"},aa={key:0,class:"text-red-600 font-medium mt-1 font-mono"},oa={key:0,class:"overflow-x-auto"},na={class:"w-full"},ra={class:"py-3 px-4"},la={class:"font-medium text-gray-900 text-sm"},ia={class:"py-3 px-4 text-right"},da={key:0,class:"font-mono text-sm text-gray-900"},ca={key:1,class:"text-gray-400 text-sm"},ua={class:"py-3 px-4 text-right"},va={key:0,class:"font-mono text-sm text-gray-900"},ma={key:1,class:"text-gray-400 text-sm"},ga={key:1,class:"text-center py-8 text-gray-500"},pa={key:2,class:"p-4 bg-gray-50 rounded-lg border border-gray-200"},fa={class:"flex items-start space-x-3"},ha={class:"w-8 h-8 bg-gray-900 rounded-full flex items-center justify-center flex-shrink-0"},ya={class:"text-white font-medium text-xs"},ba={class:"flex-1"},xa={class:"flex items-center space-x-2 mb-1"},wa={class:"font-medium text-gray-900"},_a={class:"text-gray-500 text-sm"},ka={class:"text-gray-700 text-sm"},$a={key:1,class:"text-center py-8"},Ca={class:"flex items-center justify-between p-6 border-t border-gray-200 bg-white"},Ta={class:"flex items-center space-x-3"},Aa={key:0,class:"flex items-center space-x-3"},Ma=["disabled"],Pa={key:0},Ia={key:1},ja={key:1,class:"flex items-center space-x-3"},Da=W({__name:"TransactionDetailModal",props:{isOpen:{type:Boolean},transactionId:{}},emits:["close","edit","approve","reject","updated"],setup(o,{emit:y}){const r=o,b=y,{getTransaction:E,calculateTransactionTotals:V,approveTransaction:i,rejectTransaction:g,updateTransaction:p}=ve(),{accountsList:C}=le(),{getPost:_}=oe(),{currentUser:S}=ue(),f=D(null),A=D(null),d=D(null),c=D(!1),w=D(!1),F=D(null),B=D({description:"",date:""}),x=P(()=>new Date().toISOString().split("T")[0]),t=P(()=>{var j;return((j=S.value)==null?void 0:j.personas)||[]}),l=P(()=>{if(!f.value)return null;const j=f.value.status;return{pending:{label:"Pending Review",dotColor:"bg-yellow-500"},approved:{label:"Approved",dotColor:"bg-green-500"},rejected:{label:"Rejected",dotColor:"bg-red-500"}}[j]}),h=P(()=>{var j;return(j=f.value)!=null&&j.entries?f.value.entries.map(k=>{const J=C.value.find(H=>H.id===k.accountId);return{...k,accountName:(J==null?void 0:J.name)||k.accountId,accountType:(J==null?void 0:J.type)||"unknown"}}):[]}),v=j=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(j),M=j=>{const J=Math.floor((new Date().getTime()-j.getTime())/(1e3*60));if(J<1)return"just now";if(J<60)return`${J}m ago`;if(J<1440)return`${Math.floor(J/60)}h ago`;{const H=Math.floor(J/1440);return H===1?"yesterday":H<7?`${H}d ago`:new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(j)}},U=j=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(j),N=()=>{b("close")},u=j=>{F.value=j},n=()=>{if(f.value){if(B.value.description=f.value.description,B.value.date=f.value.date.toISOString().split("T")[0],d.value){const j=t.value.find(k=>{var J;return k.name===((J=d.value)==null?void 0:J.authorPersona)});F.value=j||null}c.value=!0}},$=()=>{c.value=!1,B.value.description="",B.value.date="",F.value=null},I=async()=>{if(f.value){w.value=!0;try{const j={description:B.value.description.trim(),date:new Date(B.value.date),status:"pending"},k=await p(f.value.id,j);k&&(f.value=k),c.value=!1,k&&b("updated",k)}catch(j){console.error("Failed to update transaction:",j)}finally{w.value=!1}}},z=async()=>{if(f.value)try{await i(f.value.id,"current-user"),b("approve",f.value.id),O()}catch(j){console.error("Failed to approve transaction:",j)}},L=async()=>{if(f.value)try{await g(f.value.id),b("reject",f.value.id),O()}catch(j){console.error("Failed to reject transaction:",j)}},O=()=>{if(r.transactionId){const j=E(r.transactionId);if(j){f.value=j,A.value=V(j);const k=_(j.postId);k&&(d.value=k)}else f.value=null,A.value=null,d.value=null}c.value=!1,B.value.description="",B.value.date="",F.value=null};return re(()=>r.transactionId,()=>{O()},{immediate:!0}),(j,k)=>{var J,H;return o.isOpen?(s(),a("div",Fs,[e("div",Ss,[e("div",Bs,[e("h2",Vs,m(c.value?"Edit Transaction":"Transaction Details"),1),e("button",{onClick:N,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...k[2]||(k[2]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",zs,[f.value?(s(),a("div",Us,[c.value?(s(),a("div",Ls,[e("div",Os,[e("div",null,[k[3]||(k[3]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"}," Description ",-1)),Z(e("input",{id:"description","onUpdate:modelValue":k[0]||(k[0]=Y=>B.value.description=Y),type:"text",class:"w-full p-3 border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-gray-900 focus:border-gray-300 transition-colors",placeholder:"Enter transaction description",maxlength:"200"},null,512),[[ee,B.value.description]])]),e("div",null,[k[4]||(k[4]=e("label",{for:"date",class:"block text-sm font-medium text-gray-700 mb-2"}," Transaction Date ",-1)),Z(e("input",{id:"date","onUpdate:modelValue":k[1]||(k[1]=Y=>B.value.date=Y),type:"date",class:"w-full p-3 border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-gray-900 focus:border-gray-300 transition-colors",max:x.value},null,8,Js),[[ee,B.value.date]])]),d.value?(s(),a("div",Hs,[k[5]||(k[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Created by ",-1)),Q(ye,{"selected-persona":F.value,personas:t.value,onChange:u,placeholder:"Select persona..."},null,8,["selected-persona","personas"])])):T("",!0)])])):(s(),a("div",Ns,[e("div",qs,[e("div",Rs,[e("div",{class:q(["w-3 h-3 rounded-full",((J=l.value)==null?void 0:J.dotColor)||"bg-gray-500"])},null,2),e("div",null,[e("span",Ks,m(((H=l.value)==null?void 0:H.label)||"Unknown"),1),f.value.approvedBy?(s(),a("p",Qs," Approved by "+m(f.value.approvedBy),1)):T("",!0)])]),e("div",Gs,m(v(f.value.date)),1)]),e("div",Ys,[k[6]||(k[6]=e("h3",{class:"font-medium text-gray-900 mb-2"},"Description",-1)),e("p",Ws,m(f.value.description),1)])])),e("div",Xs,[e("div",Zs,[k[7]||(k[7]=e("h3",{class:"font-medium text-gray-900"},"Account Entries",-1)),A.value?(s(),a("div",ea,[e("span",ta,"Dr: "+m(U(A.value.totalDebits)),1),e("span",sa,"Cr: "+m(U(A.value.totalCredits)),1),A.value.isBalanced?T("",!0):(s(),a("div",aa," Unbalanced: "+m(U(A.value.balance)),1))])):T("",!0)]),h.value.length>0?(s(),a("div",oa,[e("table",na,[k[8]||(k[8]=e("thead",null,[e("tr",{class:"border-b border-gray-200"},[e("th",{class:"text-left py-3 px-4 font-medium text-gray-900 text-sm"},"Account"),e("th",{class:"text-right py-3 px-4 font-medium text-gray-900 text-sm"},"Debit"),e("th",{class:"text-right py-3 px-4 font-medium text-gray-900 text-sm"},"Credit")])],-1)),e("tbody",null,[(s(!0),a(X,null,te(h.value,Y=>(s(),a("tr",{key:Y.id,class:"border-b border-gray-100"},[e("td",ra,[e("div",la,m(Y.accountName),1)]),e("td",ia,[Y.debitAmount?(s(),a("span",da,m(U(Y.debitAmount)),1)):(s(),a("span",ca,"—"))]),e("td",ua,[Y.creditAmount?(s(),a("span",va,m(U(Y.creditAmount)),1)):(s(),a("span",ma,"—"))])]))),128))])])])):(s(),a("div",ga," No entries found for this transaction "))]),d.value&&!c.value?(s(),a("div",pa,[k[10]||(k[10]=e("h3",{class:"font-medium text-gray-900 mb-3"},"Related Post",-1)),e("div",fa,[e("div",ha,[e("span",ya,m(d.value.authorPersona.charAt(0)),1)]),e("div",ba,[e("div",xa,[e("span",wa,m(d.value.authorPersona),1),k[9]||(k[9]=e("span",{class:"text-gray-400 text-sm"},"•",-1)),e("time",_a,m(M(d.value.createdAt)),1)]),e("p",ka,m(d.value.content),1)])])])):T("",!0)])):(s(),a("div",$a,[...k[11]||(k[11]=[e("div",{class:"text-gray-500"},"Transaction not found",-1)])]))]),e("div",Ca,[e("div",Ta,[c.value?(s(),a("div",Aa,[e("button",{onClick:I,disabled:w.value,class:"px-4 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[w.value?(s(),a("span",Pa,"Saving...")):(s(),a("span",Ia,"Save Changes"))],8,Ma),e("button",{onClick:$,class:"px-4 py-2 bg-white border border-gray-200 text-gray-700 rounded-md hover:bg-gray-50 transition-colors"}," Cancel ")])):(s(),a("div",ja,[f.value&&(f.value.status==="pending"||f.value.status==="rejected")?(s(),a("button",{key:0,onClick:n,class:"px-4 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-800 transition-colors"}," Edit Transaction ")):T("",!0),f.value&&f.value.status==="pending"?(s(),a("button",{key:1,onClick:z,class:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors"}," Approve ")):T("",!0),f.value&&f.value.status==="pending"?(s(),a("button",{key:2,onClick:L,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors"}," Reject ")):T("",!0)]))]),e("button",{onClick:N,class:"px-4 py-2 bg-white border border-gray-200 text-gray-700 rounded-md hover:bg-gray-50 transition-colors"}," Close ")])])])):T("",!0)}}}),Ea={class:"space-y-6"},Fa={class:"bg-white border border-gray-200 rounded-lg shadow-sm p-6"},Sa={class:"space-y-4"},Ba={key:0,class:"flex justify-center py-12"},Va={key:1,class:"p-4 bg-red-50 border border-red-200 rounded-lg"},za={class:"flex items-start space-x-3"},Ua={class:"text-sm text-red-700 mt-1"},La={key:2,class:"text-center py-16"},Oa={key:3,class:"space-y-4"},Ja=W({__name:"FeedContainer",emits:["createJournal","viewTransaction"],setup(o,{emit:y}){const{posts:r,isLoading:b,error:E,refreshPosts:V,clearError:i,updatePost:g}=oe(),{createTransaction:p,updateTransaction:C,getTransaction:_}=ve(),S=D(!1),f=D(null),A=D(null),d=D(!1),c=D(null),w=()=>{},F=n=>{f.value=n,S.value=!0},B=n=>{c.value=n,d.value=!0},x=n=>{const $=_(n);if($){const I=r.value.find(z=>z.id===$.postId);I&&(f.value=I,A.value=$,S.value=!0)}},t=()=>{S.value=!1,f.value=null,A.value=null},l=()=>{d.value=!1,c.value=null},h=n=>{d.value=!1,x(n)},v=async n=>{try{await p(n),f.value&&await g(f.value.id,{transactionId:n.id})}catch($){console.error("Error creating transaction:",$)}},M=async n=>{try{await C(n.id,{description:n.description,date:n.date,status:n.status}),d.value&&(d.value=!1)}catch($){console.error("Error updating transaction:",$)}},U=()=>{},N=()=>{},u=()=>{i(),V()};return he(()=>{V()}),(n,$)=>(s(),a("div",Ea,[e("div",Fa,[Q(Je,{onPosted:w})]),e("div",Sa,[R(b)&&R(r).length===0?(s(),a("div",Ba,[...$[0]||($[0]=[e("div",{class:"text-center"},[e("div",{class:"w-8 h-8 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"}),e("p",{class:"text-gray-600"},"Loading posts...")],-1)])])):R(E)&&!R(b)?(s(),a("div",Va,[e("div",za,[$[3]||($[3]=e("svg",{class:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("div",null,[$[2]||($[2]=e("h3",{class:"text-sm font-medium text-red-800"},"Something went wrong",-1)),e("p",Ua,m(R(E)),1),Q(Me,{variant:"outline",size:"sm",class:"mt-3",onClick:u},{default:ae(()=>[...$[1]||($[1]=[se(" Try again ",-1)])]),_:1})])])])):!R(b)&&R(r).length===0?(s(),a("div",La,[...$[4]||($[4]=[ce('<div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg></div><h3 class="text-lg font-semibold text-gray-900 mb-2">No posts yet</h3><p class="text-gray-600">Share your first business update above</p>',3)])])):(s(),a("div",Oa,[(s(!0),a(X,null,te(R(r),I=>(s(),fe(It,{key:I.id,post:I,onCreateJournal:F,onViewTransaction:B,onEditTransaction:x},null,8,["post"]))),128))]))]),Q(be,{"is-open":S.value,post:f.value,"existing-transaction":A.value,onClose:t,onTransactionCreated:v,onTransactionUpdated:M},null,8,["is-open","post","existing-transaction"]),Q(Da,{"is-open":d.value,"transaction-id":c.value,onClose:l,onEdit:h,onApprove:U,onReject:N},null,8,["is-open","transaction-id"])]))}}),Ha={class:"space-y-8"},Na={class:"grid grid-cols-1 xl:grid-cols-4 gap-8"},qa={class:"xl:col-span-3"},Ra={class:"xl:col-span-1 space-y-6"},Ka={class:"space-y-3"},Qa={class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},Ga={class:"font-semibold text-gray-900"},Ya={class:"flex items-center justify-between p-3 bg-yellow-50 rounded-lg"},Wa={class:"font-semibold text-yellow-700"},Xa={class:"flex items-center justify-between p-3 bg-green-50 rounded-lg"},Za={class:"font-semibold text-green-700"},eo={class:"space-y-2"},no=W({__name:"SimpleHome",setup(o){const{posts:y}=oe(),r=D(!1),b=D(null),E=P(()=>y.value.length),V=P(()=>y.value.filter(C=>C.transactionId).length),i=P(()=>y.value.length*100),g=C=>{b.value=C,r.value=!0},p=C=>{console.log("View transaction:",C)};return(C,_)=>{const S=_e("router-link");return s(),a("div",Ha,[_[8]||(_[8]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Social Feed"),e("p",{class:"text-gray-600 mt-2"},"Share updates and convert them to accounting transactions")],-1)),e("div",Na,[e("div",qa,[Q(Ja,{onCreateJournal:g,onViewTransaction:p})]),e("div",Ra,[Q(ge,null,{default:ae(()=>[_[4]||(_[4]=e("div",{class:"flex items-center space-x-2 mb-4"},[e("div",{class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"})])]),e("h3",{class:"text-lg font-semibold text-gray-900"},"Quick Stats")],-1)),e("div",Ka,[e("div",Qa,[_[1]||(_[1]=e("span",{class:"text-sm text-gray-700"},"Total Posts",-1)),e("span",Ga,m(E.value),1)]),e("div",Ya,[_[2]||(_[2]=e("span",{class:"text-sm text-gray-700"},"Pending Transactions",-1)),e("span",Wa,m(V.value),1)]),e("div",Xa,[_[3]||(_[3]=e("span",{class:"text-sm text-gray-700"},"This Month",-1)),e("span",Za,"$"+m(i.value.toFixed(2)),1)])])]),_:1}),Q(ge,null,{default:ae(()=>[_[7]||(_[7]=e("div",{class:"flex items-center space-x-2 mb-4"},[e("div",{class:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-green-600",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z","clip-rule":"evenodd"})])]),e("h3",{class:"text-lg font-semibold text-gray-900"},"Quick Actions")],-1)),e("div",eo,[Q(S,{to:"/transactions",class:"w-full flex items-center space-x-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors"},{default:ae(()=>[..._[5]||(_[5]=[e("svg",{class:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),e("path",{"fill-rule":"evenodd",d:"M4 5a2 2 0 012-2v1a2 2 0 002 2h8a2 2 0 002-2V3a2 2 0 012 2v6h-3a2 2 0 00-2 2v3H6a2 2 0 01-2-2V5zm8 8a2 2 0 012-2h3l-3 3v-1z","clip-rule":"evenodd"})],-1),e("span",null,"View All Transactions",-1)])]),_:1}),Q(S,{to:"/accounts",class:"w-full flex items-center space-x-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors"},{default:ae(()=>[..._[6]||(_[6]=[e("svg",{class:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h4a2 2 0 012 2v2a2 2 0 01-2 2H8a2 2 0 01-2-2v-2z","clip-rule":"evenodd"})],-1),e("span",null,"Manage Accounts",-1)])]),_:1})])]),_:1})])]),Q(be,{"is-open":r.value,post:b.value,onClose:_[0]||(_[0]=f=>r.value=!1)},null,8,["is-open","post"])])}}});export{no as default};
